resource_types:
- name: k8s-resource
  type: docker-image
  source:
    repository: frodenas/k8s-resource

resources:
- name: <%= app['basename'] %>
  type: git
  source:
    uri: https://github.com/<%= app['name'] %>.git
    branch: <%= app['branch'].nil? ? 'master' : app['branch'] %>

- name: <%= app['basename'] %>-image
  type: docker-image
  source:
    repository: <%= app['name'] %>
    email: "{{dockerhub_email}}"
    username: "{{dockerhub_user}}"
    password: "{{dockerhub_pass}}"

- name: hackgt-cluster
  type: k8s-resource
  source:
    url: "{{k8s_url}}"
    username: "{{k8s_user}}"
    password: "{{k8s_pass}}"
    namespace: default
    skip_tls_verify: true

jobs:
- name: <%= app['basename'] %>-build-image
  plan:
  - get: <%= app['basename'] %>
    trigger: true
  - put: <%= app['basename'] %>-image
    params:
      build: <%= app['basename'] %>
    get_params:
      skip_download: true
  <% if !app['run'].nil? %>
  - put: hackgt-cluster
    params:
      spec_path: <%= app['basename'] %>/deployment.yml
  <% end %>
